<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Test Knob Progress</title>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- jQuery Knob -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-knob/1.2.13/jquery.knob.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 40px;
        }
    </style>
</head>

<body>

    <h2>Test Progress Loader</h2>

    <!-- Knob -->
    <input type="text" class="dial1" value="0"
           data-width="150" data-height="150"
           data-thickness=".25" data-fgColor="#00c853">

    <p id="debug"></p>

    <script>
        $(".dial1").knob();

        function getFileProgress() {
            return fetch("https://script.google.com/macros/s/AKfycbyi5NY8PhaUVtClM3aGfeXDtrUPqLt5MYbAgZ_ffYW4EICCcfqqEjSmoEHSZBdv3G66/exec")
                .then(res => res.json())
                .catch(err => ({ count: 0, error: err }));
        }

        function animateKnob(targetValue) {
            $({ animatedVal: 0 }).animate(
                { animatedVal: targetValue },
                {
                    duration: 3000,
                    easing: "swing",
                    step: function () {
                        $(".dial1")
                            .val(Math.ceil(this.animatedVal))
                            .trigger("change");
                    }
                }
            );
        }

        function updateProgress() {
            getFileProgress().then(data => {
                console.log("JSON:", data);
                document.getElementById("debug").innerText = JSON.stringify(data);

                if (!data || typeof data.count === "undefined") {
                    document.getElementById("debug").innerText = "JSON tidak valid";
                    return;
                }

                const count = data.count;
                const max = 100;
                const percent = Math.min(100, Math.round((count / max) * 100));

                animateKnob(percent);
            });
        }

        updateProgress();
        setInterval(updateProgress, 10000);
    </script>

</body>
</html>
